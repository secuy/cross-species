(function(){"use strict";var e={3777:function(e,t,a){var r=a(6848),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("ThreeWorld",{attrs:{msg:"Surface and Tractography 3D Viewer"}})],1)},o=[],i=function(){var e=this,t=e._self._c;return t("ThreeWorld",{attrs:{msg:e.msg}})},s=[],l=(a(8111),a(1701),function(){var e=this,t=e._self._c;return t("div",{staticClass:"three-world"},[t("h1",[e._v(e._s(e.msg))]),t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"canvas-section"},[t("div",{ref:"threeContainerLeft",staticClass:"three-container",attrs:{id:"three-container-left"}}),t("div",{staticClass:"control-panel"},[t("div",{staticClass:"view-controls"},[t("div",{staticClass:"control-group"},[t("button",{on:{click:e.resetViewLeft}},[e._v("重置视图")]),t("button",{class:{active:"inspect"===e.viewModeLeft},on:{click:e.toggleViewModeLeft}},[e._v(" "+e._s("browse"===e.viewModeLeft?"检查模式":"浏览模式")+" ")]),t("button",{class:{active:e.surfaceCheckTagLeft},attrs:{disabled:!(e.hasSurfaceLeft&&e.hasLabelsLeft)},on:{click:e.surfaceCheckLeft}},[e._v(" "+e._s(e.surfaceCheckTagLeft?"取消":"皮层对齐")+" ")])]),t("div",{staticClass:"opacity-control"},[t("label",[e._v("皮层透明度")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.opacityLeft,expression:"opacityLeft"}],attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.opacityLeft},on:{input:e.updateOpacityLeft,__r:function(t){e.opacityLeft=t.target.value}}})]),"inspect"===e.viewModeLeft&&e.vertexInfoLeft?t("div",{staticClass:"vertex-info"},[t("h3",[e._v("顶点信息")]),t("p",[e._v("索引: "+e._s(e.vertexInfoLeft.index))]),t("p",[e._v("位置: X: "+e._s(e.vertexInfoLeft.position.x)+", Y: "+e._s(e.vertexInfoLeft.position.y)+", Z: "+e._s(e.vertexInfoLeft.position.z))]),void 0!==e.vertexInfoLeft.label?t("p",[e._v("标签: "+e._s(e.vertexInfoLeft.label))]):e._e(),e.vertexInfoLeft.color?t("p",[e._v("颜色: R: "+e._s(e.vertexInfoLeft.color.r)+", G: "+e._s(e.vertexInfoLeft.color.g)+", B: "+e._s(e.vertexInfoLeft.color.b))]):e._e()]):e._e(),e.surfaceCheckTagLeft&&e.vertexInfoLeft?t("div",{staticClass:"vertex-info"},[t("h3",[e._v("顶点信息")]),t("p",[e._v("索引: "+e._s(e.vertexInfoLeft.index))]),t("p",[e._v("位置: X: "+e._s(e.vertexInfoLeft.position.x)+", Y: "+e._s(e.vertexInfoLeft.position.y)+", Z: "+e._s(e.vertexInfoLeft.position.z))]),void 0!==e.vertexInfoLeft.label?t("p",[e._v("标签: "+e._s(e.vertexInfoLeft.label))]):e._e(),e.vertexInfoLeft.color?t("p",[e._v("颜色: R: "+e._s(e.vertexInfoLeft.color.r)+", G: "+e._s(e.vertexInfoLeft.color.g)+", B: "+e._s(e.vertexInfoLeft.color.b))]):e._e()]):e._e()]),t("div",{staticClass:"file-upload"},[t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("表面文件(.surf.gii)")]),t("button",{attrs:{disabled:!e.hasSurfaceLeft},on:{click:e.discardSurfaceLeft}},[e._v("丢弃皮层")])]),t("div",{staticClass:"select-row"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedSurfLeft,expression:"selectedSurfLeft"}],on:{input:e.handleSurfSelectLeft,change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedSurfLeft=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:""}},[e._v("请选择文件")]),e._l(e.surfSysNames,(function(a){return t("option",{key:a,domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2)]),t("div",{staticClass:"file-row"},[t("input",{ref:"surfInputLeft",staticClass:"inputFileLabel",attrs:{type:"file",accept:".surf.gii"},on:{change:e.handleSurfaceUploadLeft}})])]),t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("标签文件(.label.gii)")]),t("button",{attrs:{disabled:!e.hasLabelsLeft},on:{click:e.discardLabelsLeft}},[e._v("丢弃标签")])]),t("div",{staticClass:"select-row"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedParcLeft,expression:"selectedParcLeft"}],on:{input:e.handleParcSelectLeft,change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedParcLeft=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:""}},[e._v("请选择文件")]),e._l(e.parcSysNames,(function(a){return t("option",{key:a,domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2)]),t("div",{staticClass:"file-row"},[t("input",{ref:"labelInputLeft",staticClass:"inputFileLabel",attrs:{type:"file",accept:".label.gii"},on:{change:e.handleLabelUploadLeft}})])]),t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("纤维文件(.tck)")]),t("button",{attrs:{disabled:!e.hasFibersLeft},on:{click:e.clearFibersLeft}},[e._v("清空纤维")])]),t("input",{ref:"tckInputLeft",staticClass:"inputFileLabel",attrs:{type:"file",accept:".tck",multiple:""},on:{change:e.handleTCKUploadLeft}})])])])]),t("div",{staticClass:"canvas-section"},[t("div",{ref:"threeContainerRight",staticClass:"three-container",attrs:{id:"three-container-right"}}),t("div",{staticClass:"control-panel"},[t("div",{staticClass:"view-controls"},[t("div",{staticClass:"control-group"},[t("button",{on:{click:e.resetViewRight}},[e._v("重置视图")]),t("button",{class:{active:"inspect"===e.viewModeRight},on:{click:e.toggleViewModeRight}},[e._v(" "+e._s("browse"===e.viewModeRight?"检查模式":"浏览模式")+" ")]),t("button",{class:{active:e.surfaceCheckTagRight},attrs:{disabled:!(e.hasSurfaceRight&&e.hasLabelsRight)},on:{click:e.surfaceCheckRight}},[e._v(" "+e._s(e.surfaceCheckTagRight?"取消":"皮层对齐")+" ")])]),t("div",{staticClass:"opacity-control"},[t("label",[e._v("皮层透明度")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.opacityRight,expression:"opacityRight"}],attrs:{type:"range",min:"0",max:"1",step:"0.01"},domProps:{value:e.opacityRight},on:{input:e.updateOpacityRight,__r:function(t){e.opacityRight=t.target.value}}})]),"inspect"===e.viewModeRight&&e.vertexInfoRight?t("div",{staticClass:"vertex-info"},[t("h3",[e._v("顶点信息")]),t("p",[e._v("索引: "+e._s(e.vertexInfoRight.index))]),t("p",[e._v("位置: X: "+e._s(e.vertexInfoRight.position.x)+", Y: "+e._s(e.vertexInfoRight.position.y)+", Z: "+e._s(e.vertexInfoRight.position.z))]),void 0!==e.vertexInfoRight.label?t("p",[e._v("标签: "+e._s(e.vertexInfoRight.label))]):e._e(),e.vertexInfoRight.color?t("p",[e._v("颜色: R: "+e._s(e.vertexInfoRight.color.r)+", G: "+e._s(e.vertexInfoRight.color.g)+", B: "+e._s(e.vertexInfoRight.color.b))]):e._e()]):e._e(),e.surfaceCheckTagRight&&e.vertexInfoRight?t("div",{staticClass:"vertex-info"},[t("h3",[e._v("顶点信息")]),t("p",[e._v("索引: "+e._s(e.vertexInfoRight.index))]),t("p",[e._v("位置: X: "+e._s(e.vertexInfoRight.position.x)+", Y: "+e._s(e.vertexInfoRight.position.y)+", Z: "+e._s(e.vertexInfoRight.position.z))]),void 0!==e.vertexInfoRight.label?t("p",[e._v("标签: "+e._s(e.vertexInfoRight.label))]):e._e(),e.vertexInfoRight.color?t("p",[e._v("颜色: R: "+e._s(e.vertexInfoRight.color.r)+", G: "+e._s(e.vertexInfoRight.color.g)+", B: "+e._s(e.vertexInfoRight.color.b))]):e._e()]):e._e()]),t("div",{staticClass:"file-upload"},[t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("表面文件(.surf.gii)")]),t("button",{attrs:{disabled:!e.hasSurfaceRight},on:{click:e.discardSurfaceRight}},[e._v("丢弃皮层")])]),t("div",{staticClass:"select-row"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedSurfRight,expression:"selectedSurfRight"}],on:{input:e.handleSurfSelectRight,change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedSurfRight=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:""}},[e._v("请选择文件")]),e._l(e.surfSysNames,(function(a){return t("option",{key:a,domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2)]),t("div",{staticClass:"file-row"},[t("input",{ref:"surfInputRight",staticClass:"inputFileLabel",attrs:{type:"file",accept:".surf.gii"},on:{change:e.handleSurfaceUploadRight}})])]),t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("标签文件(.label.gii)")]),t("button",{attrs:{disabled:!e.hasLabelsRight},on:{click:e.discardLabelsRight}},[e._v("丢弃标签")])]),t("div",{staticClass:"select-row"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedParcRight,expression:"selectedParcRight"}],on:{input:e.handleParcSelectRight,change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedParcRight=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:""}},[e._v("请选择文件")]),e._l(e.parcSysNames,(function(a){return t("option",{key:a,domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2)]),t("div",{staticClass:"file-row"},[t("input",{ref:"labelInputRight",staticClass:"inputFileLabel",attrs:{type:"file",accept:".label.gii"},on:{change:e.handleLabelUploadRight}})])]),t("div",{staticClass:"upload-group"},[t("div",{staticClass:"title-row"},[t("label",[e._v("纤维文件(.tck)")]),t("button",{attrs:{disabled:!e.hasFibersRight},on:{click:e.clearFibersRight}},[e._v("清空纤维")])]),t("input",{ref:"tckInputRight",staticClass:"inputFileLabel",attrs:{type:"file",accept:".tck",multiple:""},on:{change:e.handleTCKUploadRight}})])])])])])])}),c=[],u=(a(4114),a(7588),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698),a(8776));function f(e){const t=new u.$p8(16777215,.7);e.add(t);const a=[{position:[1,1,1],intensity:.5},{position:[-1,-1,-1],intensity:.5},{position:[0,1,-1],intensity:.5},{position:[0,-1,1],intensity:.5}],r=a.map((t=>{const a=new u.ZyN(16777215,t.intensity);return a.position.set(...t.position),e.add(a),a}));return{ambientLight:t,directionalLights:r}}function d(e={}){const{opacity:t=1,vertexColors:a=!1,shininess:r=5,specular:n=new u.Q1f(1118481)}=e;return new u.tXL({color:new u.Q1f(8421504),side:u.$EB,opacity:t,transparent:t<1,vertexColors:a,shininess:r,specular:n})}function p(e,t={}){Object.entries(t).forEach((([t,a])=>{void 0!==e[t]&&(e[t]=a)})),e.needsUpdate=!0}function v(e){const t=new u.YJl,a=new u.Pq0;let r=0;e.forEach((e=>{for(let t=0;t<e.length;t+=3)a.x+=e[t],a.y+=e[t+1],a.z+=e[t+2],r++})),a.divideScalar(r);const n=new u.Q1f(a.x,a.y,a.z),o={};n.getHSL(o);const i={h:o.h,s:.8,l:.6},s=new u.mrM({linewidth:1});return e.forEach((e=>{const a=new u.LoY,r=new Float32Array(e.flat());a.setAttribute("position",new u.THS(r,3));const n=.1*(Math.random()-.5),o=.1*(Math.random()-.5),l=.1*(Math.random()-.5),c=(new u.Q1f).setHSL((i.h+n)%1,Math.max(0,Math.min(1,i.s+o)),Math.max(0,Math.min(1,i.l+l))),f=s.clone();f.color.copy(c);const d=new u.N1A(a,f);t.add(d)})),t}a(4979);var h=a(8383),g=a.n(h);function w(e,t={}){const{rotateX:a=0,rotateY:r=0,rotateZ:n=0}=t,o=new u.kn4;o.makeRotationFromEuler(new u.O9p(a,r,n));const i=new u.Pq0;for(let s=0;s<e.length;s+=3)i.set(e[s],e[s+1],e[s+2]),i.applyMatrix4(o),e[s]=i.x,e[s+1]=i.y,e[s+2]=i.z;return e}function m(e){const t=e.replace(/\s/g,"").replace(/[^A-Za-z0-9+/=]/g,""),a=atob(t),r=new Uint8Array(a.length);for(let n=0;n<a.length;n++)r[n]=a.charCodeAt(n);return g().inflate(r).buffer}async function b(e,t={}){const a=new DOMParser,r=a.parseFromString(e,"text/xml"),n=r.getElementsByTagName("DataArray");let o=null,i=null;for(let u=0;u<n.length;u++){const e=n[u],t=e.getAttribute("Intent"),a=e.querySelector("Data")?.textContent;"NIFTI_INTENT_POINTSET"===t&&a?o=a.trim():"NIFTI_INTENT_TRIANGLE"===t&&a&&(i=a.trim())}if(!o||!i)throw new Error("无法找到顶点或面数据");const s=await m(o),l=await m(i);let c=new Float32Array(s);const f=new Uint32Array(l);t.rotation&&(c=w(c,t.rotation));for(let u=0;u<f.length;u+=3){const e=f[u+1];f[u+1]=f[u+2],f[u+2]=e}const d=new u.LoY;return d.setAttribute("position",new u.THS(c,3)),d.setIndex(new u.THS(f,1)),d.computeVertexNormals(),d.computeBoundingBox(),d.computeBoundingSphere(),d}async function y(e){const t=new DOMParser,a=t.parseFromString(e,"text/xml"),r=a.querySelector("DataArray");if(!r)throw new Error("未找到数据数组");const n=r.querySelector("Data")?.textContent;if(!n)throw new Error("未找到标签数据");const o=await m(n);return new Int32Array(o)}function L(e){const t={};for(let a=0;a<e;a++){const r=a/e*360,n=.8,o=.9,i=r/60,s=o*n,l=s*(1-Math.abs(i%2-1)),c=o-s;let f,d,p;[f,d,p]=i<1?[s,l,0]:i<2?[l,s,0]:i<3?[0,s,l]:i<4?[0,l,s]:i<5?[l,0,s]:[s,0,l],t[a]=new u.Q1f(f+c,d+c,p+c)}return t}function _(e,t,a){const r=e.attributes.position.count,n=new Float32Array(3*r),o=new u.Q1f(8421504);for(let i=0;i<r;i++){let e=o;if(t&&t.length===r){const r=t[i].toString();e="0"===r?o:a[r]||o}n[3*i]=e.r,n[3*i+1]=e.g,n[3*i+2]=e.b}e.setAttribute("color",new u.THS(n,3)),e.attributes.color.needsUpdate=!0}var x=a(2951);function R(e,t){const a=new u.ubm(75,e/t,.1,1e3);return a.position.z=10,a}function I(e,t){const a=new x.N(e,t);return a.enableDamping=!0,a.dampingFactor=.1,a.minDistance=1,a.maxDistance=200,a.rotateSpeed=.3,a.zoomSpeed=.5,a.panSpeed=.3,a}function C(e,t){const a=(new u.NRn).setFromObject(t),r=a.getCenter(new u.Pq0),n=a.getSize(new u.Pq0),o=Math.max(n.x,n.y,n.z),i=e.fov*(Math.PI/180);let s=Math.abs(o/Math.tan(i/2));e.position.z=3*s,e.lookAt(r)}async function S(e,t={}){const a=new DataView(e),r=new TextDecoder("utf-8"),n=new Uint8Array(e);let o="",i=0;for(let w=0;w<n.length-2;w++){const e=r.decode(n.slice(w,w+3));if("END"===e){i=w+3;break}}if(0===i)throw new Error("Header解析失败，未找到END");o=r.decode(n.slice(0,i));const s=o.split("\n"),l={},c=[];for(const w of s){if("END"===w)break;if(w.startsWith("mrtrix tracks"))l["first_line"]="mrtrix tracks";else if(w.startsWith("command_history:"))c.push(w.split(":")[1].trim());else if(w.includes(":")){const[e,t]=w.split(":");l[e.trim()]=t.trim()}}l["command_history"]=c;let u=0;if(l["file"]){const e=l["file"].match(/\d+/);e&&(u=parseInt(e[0]))}const f=l["datatype"].includes("LE"),d=l["datatype"].includes("32"),p=d?4:8,v=d?e=>a.getFloat32(e,f):e=>a.getFloat64(e,f);let h=u;const g=[];let m=[],b=0,y=0,L=!1;const _=parseInt(l["count"]);console.log("预期轨迹数量:",_);while(!L&&h+p<=e.byteLength&&g.length<_){const e=v(h),a=v(h+p),r=v(h+2*p);h+=3*p,Number.isNaN(e)||Number.isNaN(a)||Number.isNaN(r)?(b++,1===b&&(m.length>0&&(t.rotation&&(m=w(m,t.rotation)),g.push(m),m=[]),b=0)):e===1/0||a===1/0||r===1/0?(y++,1===y&&(L=!0)):(b=0,m.push(e,a,r))}return m.length>0&&g.push(m),console.log(`总共读取了 ${g.length} 条tract`),g}function F(e,t,a){const n=(0,r.KR)(1),o=(0,r.KR)(!1),i=(0,r.KR)(!1),s=(0,r.KR)(!1),l=(0,r.KR)("browse"),c=(0,r.KR)(!1),h=(0,r.KR)(null),g=(0,r.KR)(null),w=(0,r.KR)(null),m=(0,r.KR)(null),x=(0,r.KR)(null),F=(0,r.KR)([]),k=(0,r.KR)([]);let T=null,E=null,M=null,N=null,P=null,A=[],K=null,U={},O=!0,z=null,V=null,D=null,B=null,G=null;const Y=()=>{if(!e.value)return;T=new u.Z58,T.background=new u.Q1f(2894892);const t=e.value,a=t.clientWidth,r=t.clientHeight;E=R(a,r),M=new u.JeP({antialias:!0,alpha:!1,depth:!0,stencil:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"}),M.setSize(a,r),M.setClearColor(2894892,1),M.setPixelRatio(Math.min(window.devicePixelRatio,2)),t.appendChild(M.domElement),N=I(E,M.domElement),f(T),z=new u.tBo,V=new u.I9Y,M.domElement.addEventListener("click",W),j()},j=()=>{M&&T&&E&&(requestAnimationFrame(j),N&&N.enabled&&(N.update()||O)&&(M.render(T,E),O=!1))},W=e=>{if(!M||!E||!P||"inspect"!==l.value&&!c.value)return;const r=M.domElement.getBoundingClientRect();V.x=(e.clientX-r.left)/r.width*2-1,V.y=-(e.clientY-r.top)/r.height*2+1,z.setFromCamera(V,E);const n=z.intersectObject(P);if(n.length>0){const e=n[0],r=e.face.a,o=P.geometry.attributes.position,s=new u.Pq0(o.getX(r),o.getY(r),o.getZ(r));if($(s),h.value=r,g.value={index:r,position:{x:s.x.toFixed(2),y:s.y.toFixed(2),z:s.z.toFixed(2)}},i.value&&K){const e=K[r];if(g.value.label=e,G=e,U[e.toString()]){const t=U[e.toString()];g.value.color={r:t.r.toFixed(2),g:t.g.toFixed(2),b:t.b.toFixed(2)}}}if(c&&"inspect"!==l.value){X(G);const e="left"===a?"right":"left",r=t[e];r.flushChooseLabelOnSurf(G)}O=!0}else q(),h.value=null,g.value=null,O=!0},X=e=>{if(K&&U){const t=K.map((t=>t===e?t:0));_(P.geometry,t,U)}O=!0},Z=()=>{i.value&&K&&(_(P.geometry,K,U),q(),h.value=null,g.value=null),O=!0},$=e=>{q();const t=new u.Gu$(2,32,32);D=new u.tXL({color:14540253,transparent:!0,depthTest:!1,depthWrite:!1}),B=new u.eaF(t,D),B.position.copy(e),T.add(B),M.render(T,E),O=!0},q=()=>{B&&(T.remove(B),B.geometry.dispose(),D.dispose(),B=null,O=!0)},H=()=>{c.value=!1,Z(),l.value="browse"===l.value?"inspect":"browse",O=!0},Q=()=>{"inspect"===l.value&&H(),c.value?c.value=!1:c.value=!0,Z();const e="left"===a?"right":"left",r=t[e];r.refreshSurfaceLabel(),O=!0},J=async e=>{try{const t=await fetch(`/cross-species/surfaces/${e}`);if(!t.ok)throw new Error("Failed to load surface file");const a=await t.text();await ee(a)}catch(t){console.error("从服务器加载GIFTI文件时出错:",t)}},ee=async e=>{try{const t={rotation:{rotateX:-Math.PI/2,rotateY:0,rotateZ:Math.PI/2}},a=await b(e,t),r=d({opacity:n.value,transparent:n.value<1}),i=new u.eaF(a,r);P&&(T.remove(P),P.geometry.dispose(),P.material.dispose()),P=i,T.add(i),o.value=!0,C(E,i),O=!0}catch(t){console.error("处理GIFTI文件内容时出错:",t)}},te=async e=>{try{const t=await fetch(`/cross-species/cross-species_parcellation/${e}`);if(!t.ok)throw new Error("Failed to load label file");const a=await t.text();await ae(a)}catch(t){console.error("从服务器加载标签文件时出错:",t)}},ae=async e=>{try{K=await y(e);const t=new Set(K),a=Array.from(t).sort(((e,t)=>e-t)),r=L(a.length);U={},a.forEach(((e,t)=>{U[e.toString()]=r[t]})),i.value=!0,_(P.geometry,K,U),P.material.vertexColors=!0,P.material.needsUpdate=!0,O=!0}catch(t){console.error("处理标签文件内容时出错:",t)}},re=async e=>{try{const t=await fetch(`/cross-species/tracks/${e}`);if(!t.ok)throw new Error("Failed to load TCK file");const a=await t.arrayBuffer();await ne(a)}catch(t){console.error("从服务器加载TCK文件时出错:",t)}},ne=async e=>{try{const t={rotation:{rotateX:-Math.PI/2,rotateY:0,rotateZ:Math.PI/2}},a=await S(e,t),r=v(a);A.push(r),T.add(r),s.value=!0,P?C(E,P):A.length>0&&C(E,A[0]),O=!0}catch(t){console.error("处理TCK文件内容时出错:",t)}},oe=e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async e=>{await ee(e.target.result)},e.readAsText(t)}},ie=async e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=async e=>{await ae(e.target.result)},e.readAsText(t)}},se=async e=>{const t=e.target.files;if(t&&0!==t.length)try{const t=Array.from(e.target.files);if(t.length>0)for(const e of t){const t=await e.arrayBuffer();await ne(t)}}catch(a){console.error("加载.tck文件时出错:",a)}},le=()=>{if(P&&o.value){T.remove(P),P.geometry.dispose(),P.material.dispose(),o.value=!1,i.value&&(K=null,U={},i.value=!1),"inspect"===l.value&&(q(),h.value=null,g.value=null),O=!0,w.value&&(w.value.value=""),m.value&&(m.value.value="");const e=new CustomEvent("reset-surface-select",{detail:{side:a}});window.dispatchEvent(e);const t=new CustomEvent("reset-label-select",{detail:{side:a}});window.dispatchEvent(t)}},ce=()=>{if(P&&i.value){const e=P.geometry;e.getAttribute("color")&&(e.deleteAttribute("color"),e.attributes.position.needsUpdate=!0);const t=P.material;t.vertexColors=!1,t.color.set(8421504),t.needsUpdate=!0,K=null,U={},i.value=!1,"inspect"===l.value&&(q(),h.value=null,g.value=null),O=!0,m.value&&(m.value.value="");const r=new CustomEvent("reset-label-select",{detail:{side:a}});window.dispatchEvent(r)}},ue=()=>{A&&T&&(A.forEach((e=>{e&&(e.children?(e.children.forEach((e=>{e&&T&&(T.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose())})),T.remove(e)):(T.remove(e),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()))})),A=[],s.value=!1,O=!0,x.value&&(x.value.value=""))},fe=()=>{P&&C(E,P,N),O=!0},de=()=>{P&&(p(P.material,{opacity:n.value,transparent:n.value<1}),O=!0)},pe=()=>{if(!e.value||!M||!E)return;const t=e.value,a=t.clientWidth,r=t.clientHeight;E.aspect=a/r,E.updateProjectionMatrix(),M.setSize(a,r),O=!0},ve=async(e,t)=>{try{const a=await fetch(`/cross-species/${e}/${t}`);if(!a.ok)throw new Error("Failed to load file list");const r=await a.json();return r}catch(a){return console.error("Error fetching file names:",a),[]}};return(0,r.sV)((()=>{Y(),window.addEventListener("resize",pe),ve("surfaces","surfList.json").then((e=>{F.value=e})).catch((e=>{console.error("Error fetching files:",e)})),ve("cross-species_parcellation","parcList.json").then((e=>{k.value=e})).catch((e=>{console.error("Error fetching files:",e)}))})),(0,r.xo)((()=>{window.removeEventListener("resize",pe),M&&(M.domElement.removeEventListener("click",W),M.dispose()),P&&(P.geometry.dispose(),P.material.dispose()),T=null,E=null,M=null,N=null,P=null,A=[],K=null,U={},z=null,V=null,D=null,B=null})),{opacity:n,hasSurface:o,hasLabels:i,hasFibers:s,surfInput:w,labelInput:m,tckInput:x,viewMode:l,surfaceCheckTag:c,vertexInfo:g,currentMesh:P,vertexLabels:K,labelColors:U,surfSysNames:F,parcSysNames:k,handleSurfaceUpload:oe,handleLabelUpload:ie,handleTCKUpload:se,discardSurface:le,discardLabels:ce,clearFibers:ue,resetView:fe,updateOpacity:de,toggleViewMode:H,surfaceCheck:Q,refreshSurfaceLabel:Z,flushChooseLabelOnSurf:X,loadGIFTIFileFromServer:J,loadLabelGIFTIFileFromServer:te,loadTCKFileFromServer:re}}var k={name:"ThreeWorld",props:{msg:String},setup(){const e=(0,r.KR)(null),t=(0,r.KR)(null),a=(0,r.Kh)({left:null,right:null}),n=F(e,a,"left"),o=F(t,a,"right"),i=(0,r.KR)(""),s=(0,r.KR)(""),l=(0,r.KR)(""),c=(0,r.KR)("");(0,r.sV)((()=>{window.addEventListener("reset-surface-select",(e=>{"left"===e.detail.side?i.value="":l.value=""})),window.addEventListener("reset-label-select",(e=>{"left"===e.detail.side?s.value="":c.value=""}))})),(0,r.xo)((()=>{window.removeEventListener("reset-surface-select",(()=>{})),window.removeEventListener("reset-label-select",(()=>{}))})),(0,r.dY)((()=>{a.left=n,a.right=o}));const u=async e=>{const t=e.target.value;t&&await n.loadGIFTIFileFromServer(t)},f=async e=>{const t=e.target.value;t&&await n.loadLabelGIFTIFileFromServer(t)},d=async e=>{const t=e.target.value;t&&await o.loadGIFTIFileFromServer(t)},p=async e=>{const t=e.target.value;t&&await o.loadLabelGIFTIFileFromServer(t)};return{threeContainerLeft:e,threeContainerRight:t,surfSysNames:n.surfSysNames,parcSysNames:n.parcSysNames,opacityLeft:n.opacity,hasSurfaceLeft:n.hasSurface,hasLabelsLeft:n.hasLabels,hasFibersLeft:n.hasFibers,surfInputLeft:n.surfInput,labelInputLeft:n.labelInput,tckInputLeft:n.tckInput,viewModeLeft:n.viewMode,surfaceCheckTagLeft:n.surfaceCheckTag,vertexInfoLeft:n.vertexInfo,handleSurfaceUploadLeft:n.handleSurfaceUpload,handleLabelUploadLeft:n.handleLabelUpload,handleTCKUploadLeft:n.handleTCKUpload,discardSurfaceLeft:n.discardSurface,discardLabelsLeft:n.discardLabels,clearFibersLeft:n.clearFibers,resetViewLeft:n.resetView,updateOpacityLeft:n.updateOpacity,toggleViewModeLeft:n.toggleViewMode,surfaceCheckLeft:n.surfaceCheck,opacityRight:o.opacity,hasSurfaceRight:o.hasSurface,hasLabelsRight:o.hasLabels,hasFibersRight:o.hasFibers,surfInputRight:o.surfInput,labelInputRight:o.labelInput,tckInputRight:o.tckInput,viewModeRight:o.viewMode,surfaceCheckTagRight:o.surfaceCheckTag,vertexInfoRight:o.vertexInfo,handleSurfaceUploadRight:o.handleSurfaceUpload,handleLabelUploadRight:o.handleLabelUpload,handleTCKUploadRight:o.handleTCKUpload,discardSurfaceRight:o.discardSurface,discardLabelsRight:o.discardLabels,clearFibersRight:o.clearFibers,resetViewRight:o.resetView,updateOpacityRight:o.updateOpacity,toggleViewModeRight:o.toggleViewMode,surfaceCheckRight:o.surfaceCheck,selectedSurfLeft:i,selectedParcLeft:s,selectedSurfRight:l,selectedParcRight:c,handleSurfSelectLeft:u,handleParcSelectLeft:f,handleSurfSelectRight:d,handleParcSelectRight:p}}},T=k,E=a(1656),M=(0,E.A)(T,l,c,!1,null,null,null),N=M.exports,P={name:"ThreeWorldWrapper",components:{ThreeWorld:N},props:{msg:String}},A=P,K=(0,E.A)(A,i,s,!1,null,null,null),U=K.exports,O={name:"App",components:{ThreeWorld:U}},z=O,V=(0,E.A)(z,n,o,!1,null,null,null),D=V.exports;r.Ay.config.productionTip=!1,new r.Ay({render:e=>e(D)}).$mount("#app")}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,r,n,o){if(!r){var i=1/0;for(u=0;u<e.length;u++){r=e[u][0],n=e[u][1],o=e[u][2];for(var s=!0,l=0;l<r.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](r[l])}))?r.splice(l--,1):(s=!1,o<i&&(i=o));if(s){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,n,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,o,i=r[0],s=r[1],l=r[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(l)var u=l(a)}for(t&&t(r);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(u)},r=self["webpackChunkcross_species_platform"]=self["webpackChunkcross_species_platform"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=a.O(void 0,[504],(function(){return a(3777)}));r=a.O(r)})();
//# sourceMappingURL=app.116da1c5.js.map